<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark px-3">
  <span class="navbar-brand">HOA Admin Panel</span>
  <button class="btn btn-danger btn-sm" onclick="logout()">Logout</button>
</nav>

<div class="container mt-4">
  <h3>Pending Payments</h3>

  <table class="table table-bordered table-striped mt-3">
    <thead>
      <tr>
        <th>ID</th>
        <th>User</th>
        <th>File</th>
        <th>Status</th>
        <th>Uploaded</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="payments"></tbody>
  </table>
</div>

<script>
const username = localStorage.getItem("username");
const role = localStorage.getItem("role");

// ðŸ”’ SECURITY CHECK
if (!username || role !== "admin") {
  alert("Unauthorized");
  window.location.href = "/login";
}

async function loadPayments() {
  const res = await fetch(`/api/admin/payments?username=${username}`);
  const data = await res.json();

  const tbody = document.getElementById("payments");
  tbody.innerHTML = "";

  data.forEach(p => {
    const row = document.createElement("tr");

    row.innerHTML = `
      <td>${p[0]}</td>
      <td>${p[1]}</td>
      <td>${p[2]}</td>
      <td>${p[3]}</td>
      <td>${p[4]}</td>
      <td>
        ${p[3] === "PENDING"
          ? `<button class="btn btn-success btn-sm" onclick="approve(${p[0]})">Approve</button>`
          : "â€”"}
      </td>
    `;

    tbody.appendChild(row);
  });
}

async function approve(id) {
  await fetch(`/api/admin/approve/${id}?username=${username}`, {
    method: "POST"
  });
  loadPayments();
}

function logout() {
  localStorage.clear();
  window.location.href = "/login";
}

loadPayments();
</script>

</body>
</html>
