<!DOCTYPE html>
<html>
<head>
  <title>User Dashboard</title>
</head>
<body>

<h3>User Dashboard</h3>

<select id="month">
  <option>January</option><option>February</option>
</select>

<input id="year" value="2024">
<input id="amount" type="number" placeholder="Amount">

<input type="file" id="receipt">
<button onclick="upload()">Upload</button>

<p id="msg"></p>

<hr>
<h4>My Payments</h4>
<table border="1">
  <tbody id="history"></tbody>
</table>

<script>
const username = localStorage.getItem("username");

async function upload() {
  const form = new FormData();
  form.append("file", receipt.files[0]);

  const url =
    `/api/upload-receipt?username=${username}` +
    `&month=${month.value}&year=${year.value}&amount=${amount.value}`;

  const res = await fetch(url, {
    method: "POST",
    body: form
  });

  const data = await res.json();
  msg.innerText = data.message || data.detail;
  load();
}

async function load() {
  const res = await fetch(`/api/user/payments/${username}`);
  const data = await res.json();

  history.innerHTML = data.map(p => `
    <tr>
      <td>${p[4]} ${p[5]}</td>
      <td>â‚±${p[6]}</td>
      <td>${p[2]}</td>
      <td><a href="/uploads/${p[1]}" target="_blank">View</a></td>
    </tr>
  `).join("");
}

load();
</script>

</body>
</html>
